3257332331b92238d8a13ba2d014271a
/**
 * Integration Tests for Projects API (GET)
 * Tests the actual API route with mocked dependencies
 */ "use strict";
// Mock dependencies
jest.mock('../../../app/api/auth/[...nextauth]/route', ()=>({
        authOptions: {}
    }));
jest.mock('next-auth', ()=>({
        getServerSession: jest.fn()
    }));
jest.mock('../../../app/lib/prisma', ()=>({
        prisma: {
            project: {
                count: jest.fn(),
                findMany: jest.fn(),
                findUnique: jest.fn(),
                findFirst: jest.fn(),
                create: jest.fn(),
                update: jest.fn(),
                delete: jest.fn(),
                deleteMany: jest.fn()
            },
            user: {
                findUnique: jest.fn(),
                findFirst: jest.fn(),
                create: jest.fn(),
                update: jest.fn(),
                delete: jest.fn()
            }
        }
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _route = require("../../../app/api/projects/route");
const _fixtures = require("../../fixtures");
const _nextauth = require("next-auth");
const _prisma = require("../../../app/lib/prisma");
const mockGetServerSession = _nextauth.getServerSession;
const mockPrisma = _prisma.prisma;
describe('Projects API Integration Tests', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
    });
    /**
   * Scenario: Authenticated user retrieves projects
   */ describe('Scenario: Authenticated user retrieves projects', ()=>{
        test('Given I am authenticated as user and have projects, When I make GET request, Then I receive 200 with projects', async ()=>{
            // Given: I am authenticated and have projects (using centralized fixtures)
            const authenticatedUser = {
                user: _fixtures.testUsers.john
            };
            mockGetServerSession.mockResolvedValue(authenticatedUser);
            // Set up database with user's projects
            const userProjects = _fixtures.projectScenarios.userWithProjects.projects;
            mockPrisma.project.count.mockResolvedValue(userProjects.length);
            mockPrisma.project.findMany.mockResolvedValue(userProjects);
            // When: I make a GET request to "/api/projects"
            const response = await (0, _route.GET)();
            const data = await response.json();
            // Then: I should receive a 200 status code with my projects
            expect(response.status).toBe(200);
            expect(data).toHaveLength(3);
            // And: each project should include required fields (flexible date checking)
            data.forEach((project)=>{
                expect(project).toHaveProperty('id', expect.any(String));
                expect(project).toHaveProperty('name', expect.any(String));
                expect(project).toHaveProperty('user', expect.any(Object));
                expect(project).toHaveProperty('emailSettings');
                expect(project).toHaveProperty('_count.flaggedItems', expect.any(Number));
                expect(project).toHaveProperty('_count.timelineEntries', expect.any(Number));
                expect(project).toHaveProperty('userId', _fixtures.testUsers.john.id);
            });
            // And: first project should be kitchen renovation
            expect(data[0]).toMatchObject({
                id: 'project-1',
                name: 'Kitchen Renovation',
                contractor: 'Mike Johnson Construction',
                architect: 'Sarah Chen Design',
                userId: _fixtures.testUsers.john.id
            });
        });
        test('Given I am authenticated, When projects are fetched, Then correct database query is made', async ()=>{
            // Given: I am authenticated as a user (using centralized fixtures)
            mockGetServerSession.mockResolvedValue({
                user: _fixtures.testUsers.john
            });
            mockPrisma.project.count.mockResolvedValue(1);
            mockPrisma.project.findMany.mockResolvedValue([
                _fixtures.testProjects.kitchenReno
            ]);
            // When: projects are fetched
            await (0, _route.GET)();
            // Then: correct database query should be made
            expect(mockPrisma.project.findMany).toHaveBeenCalledWith({
                where: {
                    userId: _fixtures.testUsers.john.id
                },
                include: expect.objectContaining({
                    user: true,
                    emailSettings: true,
                    _count: {
                        select: {
                            flaggedItems: {
                                where: {
                                    status: 'PENDING'
                                }
                            },
                            timelineEntries: true
                        }
                    }
                }),
                orderBy: [
                    {
                        status: 'asc'
                    },
                    {
                        createdAt: 'desc'
                    }
                ]
            });
        });
    });
    /**
   * Scenario: Unauthenticated user attempts to access projects
   */ describe('Scenario: Unauthenticated user attempts to access projects', ()=>{
        test('Given I am not authenticated, When I make GET request, Then I receive 401 with error message', async ()=>{
            // Given: I am not authenticated
            mockGetServerSession.mockResolvedValue(null);
            // When: I make a GET request to "/api/projects"
            const response = await (0, _route.GET)();
            const data = await response.json();
            // Then: I should receive a 401 status code with error message
            expect(response.status).toBe(401);
            expect(data).toEqual({
                error: 'Unauthorized'
            });
        });
    });
    /**
   * Scenario: Empty projects list
   */ describe('Scenario: Empty projects list', ()=>{
        test('Given I am authenticated but have no projects, When I make GET request, Then I receive empty array', async ()=>{
            // Given: I am authenticated but have no projects (using centralized fixtures)
            mockGetServerSession.mockResolvedValue({
                user: _fixtures.testUsers.jane
            });
            mockPrisma.project.count.mockResolvedValue(0);
            mockPrisma.project.findMany.mockResolvedValue([]);
            // When: I make a GET request to "/api/projects"
            const response = await (0, _route.GET)();
            const data = await response.json();
            // Then: I should receive a 200 status code with empty array
            expect(response.status).toBe(200);
            expect(data).toEqual([]);
            expect(Array.isArray(data)).toBe(true);
            expect(data).toHaveLength(0);
        });
    });
    /**
   * Scenario: Database error handling
   */ describe('Scenario: Database error handling', ()=>{
        test('Given I am authenticated, When database fails, Then I receive 500 with error message', async ()=>{
            // Given: I am authenticated but database encounters an error (using centralized fixtures)
            mockGetServerSession.mockResolvedValue({
                user: _fixtures.testUsers.john
            });
            mockPrisma.project.count.mockRejectedValue(new Error('Database connection failed'));
            // When: I make a GET request to "/api/projects"
            const response = await (0, _route.GET)();
            const data = await response.json();
            // Then: I should receive a 500 status code with appropriate error message
            expect(response.status).toBe(500);
            expect(data).toEqual({
                error: 'Failed to fetch projects'
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9rZW5ueWMvY29kZS9wZXJzb25hbC9uYWlsaXQvdGVzdHMvaW50ZWdyYXRpb24vYXBpL3Byb2plY3RzLWdldC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW50ZWdyYXRpb24gVGVzdHMgZm9yIFByb2plY3RzIEFQSSAoR0VUKVxuICogVGVzdHMgdGhlIGFjdHVhbCBBUEkgcm91dGUgd2l0aCBtb2NrZWQgZGVwZW5kZW5jaWVzXG4gKi9cblxuaW1wb3J0IHsgR0VUIH0gZnJvbSAnLi4vLi4vLi4vYXBwL2FwaS9wcm9qZWN0cy9yb3V0ZSdcblxuLy8gVXNlIGNlbnRyYWxpemVkIGZpeHR1cmVzXG5pbXBvcnQge1xuICB0ZXN0VXNlcnMsXG4gIHRlc3RQcm9qZWN0cyxcbiAgcHJvamVjdFNjZW5hcmlvcyxcbn0gZnJvbSAnLi4vLi4vZml4dHVyZXMnXG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJy4uLy4uLy4uL2FwcC9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlJywgKCkgPT4gKHtcbiAgYXV0aE9wdGlvbnM6IHt9LFxufSkpXG5cbmplc3QubW9jaygnbmV4dC1hdXRoJywgKCkgPT4gKHtcbiAgZ2V0U2VydmVyU2Vzc2lvbjogamVzdC5mbigpLFxufSkpXG5cbmplc3QubW9jaygnLi4vLi4vLi4vYXBwL2xpYi9wcmlzbWEnLCAoKSA9PiAoe1xuICBwcmlzbWE6IHtcbiAgICBwcm9qZWN0OiB7XG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRGaXJzdDogamVzdC5mbigpLFxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgICAgZGVsZXRlTWFueTogamVzdC5mbigpLFxuICAgIH0sXG4gICAgdXNlcjoge1xuICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgICAgZmluZEZpcnN0OiBqZXN0LmZuKCksXG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgfSxcbiAgfSxcbn0pKVxuXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi4vLi4vLi4vYXBwL2xpYi9wcmlzbWEnXG5cbmNvbnN0IG1vY2tHZXRTZXJ2ZXJTZXNzaW9uID0gZ2V0U2VydmVyU2Vzc2lvbiBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBnZXRTZXJ2ZXJTZXNzaW9uPlxuY29uc3QgbW9ja1ByaXNtYSA9IHByaXNtYSBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgcHJpc21hPlxuXG5kZXNjcmliZSgnUHJvamVjdHMgQVBJIEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKVxuICB9KVxuXG4gIC8qKlxuICAgKiBTY2VuYXJpbzogQXV0aGVudGljYXRlZCB1c2VyIHJldHJpZXZlcyBwcm9qZWN0c1xuICAgKi9cbiAgZGVzY3JpYmUoJ1NjZW5hcmlvOiBBdXRoZW50aWNhdGVkIHVzZXIgcmV0cmlldmVzIHByb2plY3RzJywgKCkgPT4ge1xuICAgIHRlc3QoJ0dpdmVuIEkgYW0gYXV0aGVudGljYXRlZCBhcyB1c2VyIGFuZCBoYXZlIHByb2plY3RzLCBXaGVuIEkgbWFrZSBHRVQgcmVxdWVzdCwgVGhlbiBJIHJlY2VpdmUgMjAwIHdpdGggcHJvamVjdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHaXZlbjogSSBhbSBhdXRoZW50aWNhdGVkIGFuZCBoYXZlIHByb2plY3RzICh1c2luZyBjZW50cmFsaXplZCBmaXh0dXJlcylcbiAgICAgIGNvbnN0IGF1dGhlbnRpY2F0ZWRVc2VyID0geyB1c2VyOiB0ZXN0VXNlcnMuam9obiB9XG4gICAgICBtb2NrR2V0U2VydmVyU2Vzc2lvbi5tb2NrUmVzb2x2ZWRWYWx1ZShhdXRoZW50aWNhdGVkVXNlciBhcyBhbnkpXG4gICAgICBcbiAgICAgIC8vIFNldCB1cCBkYXRhYmFzZSB3aXRoIHVzZXIncyBwcm9qZWN0c1xuICAgICAgY29uc3QgdXNlclByb2plY3RzID0gcHJvamVjdFNjZW5hcmlvcy51c2VyV2l0aFByb2plY3RzLnByb2plY3RzXG4gICAgICBtb2NrUHJpc21hLnByb2plY3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWUodXNlclByb2plY3RzLmxlbmd0aClcbiAgICAgIG1vY2tQcmlzbWEucHJvamVjdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyUHJvamVjdHMpXG5cbiAgICAgIC8vIFdoZW46IEkgbWFrZSBhIEdFVCByZXF1ZXN0IHRvIFwiL2FwaS9wcm9qZWN0c1wiXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVCgpXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG5cbiAgICAgIC8vIFRoZW46IEkgc2hvdWxkIHJlY2VpdmUgYSAyMDAgc3RhdHVzIGNvZGUgd2l0aCBteSBwcm9qZWN0c1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApXG4gICAgICBleHBlY3QoZGF0YSkudG9IYXZlTGVuZ3RoKDMpXG4gICAgICBcbiAgICAgIC8vIEFuZDogZWFjaCBwcm9qZWN0IHNob3VsZCBpbmNsdWRlIHJlcXVpcmVkIGZpZWxkcyAoZmxleGlibGUgZGF0ZSBjaGVja2luZylcbiAgICAgIGRhdGEuZm9yRWFjaCgocHJvamVjdDogYW55KSA9PiB7XG4gICAgICAgIGV4cGVjdChwcm9qZWN0KS50b0hhdmVQcm9wZXJ0eSgnaWQnLCBleHBlY3QuYW55KFN0cmluZykpXG4gICAgICAgIGV4cGVjdChwcm9qZWN0KS50b0hhdmVQcm9wZXJ0eSgnbmFtZScsIGV4cGVjdC5hbnkoU3RyaW5nKSlcbiAgICAgICAgZXhwZWN0KHByb2plY3QpLnRvSGF2ZVByb3BlcnR5KCd1c2VyJywgZXhwZWN0LmFueShPYmplY3QpKVxuICAgICAgICBleHBlY3QocHJvamVjdCkudG9IYXZlUHJvcGVydHkoJ2VtYWlsU2V0dGluZ3MnKVxuICAgICAgICBleHBlY3QocHJvamVjdCkudG9IYXZlUHJvcGVydHkoJ19jb3VudC5mbGFnZ2VkSXRlbXMnLCBleHBlY3QuYW55KE51bWJlcikpXG4gICAgICAgIGV4cGVjdChwcm9qZWN0KS50b0hhdmVQcm9wZXJ0eSgnX2NvdW50LnRpbWVsaW5lRW50cmllcycsIGV4cGVjdC5hbnkoTnVtYmVyKSlcbiAgICAgICAgZXhwZWN0KHByb2plY3QpLnRvSGF2ZVByb3BlcnR5KCd1c2VySWQnLCB0ZXN0VXNlcnMuam9obi5pZClcbiAgICAgIH0pXG5cbiAgICAgIC8vIEFuZDogZmlyc3QgcHJvamVjdCBzaG91bGQgYmUga2l0Y2hlbiByZW5vdmF0aW9uXG4gICAgICBleHBlY3QoZGF0YVswXSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIGlkOiAncHJvamVjdC0xJyxcbiAgICAgICAgbmFtZTogJ0tpdGNoZW4gUmVub3ZhdGlvbicsXG4gICAgICAgIGNvbnRyYWN0b3I6ICdNaWtlIEpvaG5zb24gQ29uc3RydWN0aW9uJyxcbiAgICAgICAgYXJjaGl0ZWN0OiAnU2FyYWggQ2hlbiBEZXNpZ24nLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2Vycy5qb2huLmlkLFxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgdGVzdCgnR2l2ZW4gSSBhbSBhdXRoZW50aWNhdGVkLCBXaGVuIHByb2plY3RzIGFyZSBmZXRjaGVkLCBUaGVuIGNvcnJlY3QgZGF0YWJhc2UgcXVlcnkgaXMgbWFkZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdpdmVuOiBJIGFtIGF1dGhlbnRpY2F0ZWQgYXMgYSB1c2VyICh1c2luZyBjZW50cmFsaXplZCBmaXh0dXJlcylcbiAgICAgIG1vY2tHZXRTZXJ2ZXJTZXNzaW9uLm1vY2tSZXNvbHZlZFZhbHVlKHsgdXNlcjogdGVzdFVzZXJzLmpvaG4gfSBhcyBhbnkpXG4gICAgICBtb2NrUHJpc21hLnByb2plY3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMSlcbiAgICAgIG1vY2tQcmlzbWEucHJvamVjdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbdGVzdFByb2plY3RzLmtpdGNoZW5SZW5vXSlcblxuICAgICAgLy8gV2hlbjogcHJvamVjdHMgYXJlIGZldGNoZWRcbiAgICAgIGF3YWl0IEdFVCgpXG5cbiAgICAgIC8vIFRoZW46IGNvcnJlY3QgZGF0YWJhc2UgcXVlcnkgc2hvdWxkIGJlIG1hZGVcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLnByb2plY3QuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiB0ZXN0VXNlcnMuam9obi5pZCB9LFxuICAgICAgICBpbmNsdWRlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICBlbWFpbFNldHRpbmdzOiB0cnVlLFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGZsYWdnZWRJdGVtczoge1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IHN0YXR1czogJ1BFTkRJTkcnIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGltZWxpbmVFbnRyaWVzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgb3JkZXJCeTogW1xuICAgICAgICAgIHsgc3RhdHVzOiAnYXNjJyB9LFxuICAgICAgICAgIHsgY3JlYXRlZEF0OiAnZGVzYycgfVxuICAgICAgICBdXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG5cbiAgLyoqXG4gICAqIFNjZW5hcmlvOiBVbmF1dGhlbnRpY2F0ZWQgdXNlciBhdHRlbXB0cyB0byBhY2Nlc3MgcHJvamVjdHNcbiAgICovXG4gIGRlc2NyaWJlKCdTY2VuYXJpbzogVW5hdXRoZW50aWNhdGVkIHVzZXIgYXR0ZW1wdHMgdG8gYWNjZXNzIHByb2plY3RzJywgKCkgPT4ge1xuICAgIHRlc3QoJ0dpdmVuIEkgYW0gbm90IGF1dGhlbnRpY2F0ZWQsIFdoZW4gSSBtYWtlIEdFVCByZXF1ZXN0LCBUaGVuIEkgcmVjZWl2ZSA0MDEgd2l0aCBlcnJvciBtZXNzYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2l2ZW46IEkgYW0gbm90IGF1dGhlbnRpY2F0ZWRcbiAgICAgIG1vY2tHZXRTZXJ2ZXJTZXNzaW9uLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpXG5cbiAgICAgIC8vIFdoZW46IEkgbWFrZSBhIEdFVCByZXF1ZXN0IHRvIFwiL2FwaS9wcm9qZWN0c1wiXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVCgpXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG5cbiAgICAgIC8vIFRoZW46IEkgc2hvdWxkIHJlY2VpdmUgYSA0MDEgc3RhdHVzIGNvZGUgd2l0aCBlcnJvciBtZXNzYWdlXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMSlcbiAgICAgIGV4cGVjdChkYXRhKS50b0VxdWFsKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pXG4gICAgfSlcbiAgfSlcblxuICAvKipcbiAgICogU2NlbmFyaW86IEVtcHR5IHByb2plY3RzIGxpc3RcbiAgICovXG4gIGRlc2NyaWJlKCdTY2VuYXJpbzogRW1wdHkgcHJvamVjdHMgbGlzdCcsICgpID0+IHtcbiAgICB0ZXN0KCdHaXZlbiBJIGFtIGF1dGhlbnRpY2F0ZWQgYnV0IGhhdmUgbm8gcHJvamVjdHMsIFdoZW4gSSBtYWtlIEdFVCByZXF1ZXN0LCBUaGVuIEkgcmVjZWl2ZSBlbXB0eSBhcnJheScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdpdmVuOiBJIGFtIGF1dGhlbnRpY2F0ZWQgYnV0IGhhdmUgbm8gcHJvamVjdHMgKHVzaW5nIGNlbnRyYWxpemVkIGZpeHR1cmVzKVxuICAgICAgbW9ja0dldFNlcnZlclNlc3Npb24ubW9ja1Jlc29sdmVkVmFsdWUoeyB1c2VyOiB0ZXN0VXNlcnMuamFuZSB9IGFzIGFueSlcbiAgICAgIG1vY2tQcmlzbWEucHJvamVjdC5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgwKVxuICAgICAgbW9ja1ByaXNtYS5wcm9qZWN0LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKVxuXG4gICAgICAvLyBXaGVuOiBJIG1ha2UgYSBHRVQgcmVxdWVzdCB0byBcIi9hcGkvcHJvamVjdHNcIlxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQoKVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuXG4gICAgICAvLyBUaGVuOiBJIHNob3VsZCByZWNlaXZlIGEgMjAwIHN0YXR1cyBjb2RlIHdpdGggZW1wdHkgYXJyYXlcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKVxuICAgICAgZXhwZWN0KGRhdGEpLnRvRXF1YWwoW10pXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShkYXRhKSkudG9CZSh0cnVlKVxuICAgICAgZXhwZWN0KGRhdGEpLnRvSGF2ZUxlbmd0aCgwKVxuICAgIH0pXG4gIH0pXG5cbiAgLyoqXG4gICAqIFNjZW5hcmlvOiBEYXRhYmFzZSBlcnJvciBoYW5kbGluZ1xuICAgKi9cbiAgZGVzY3JpYmUoJ1NjZW5hcmlvOiBEYXRhYmFzZSBlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdHaXZlbiBJIGFtIGF1dGhlbnRpY2F0ZWQsIFdoZW4gZGF0YWJhc2UgZmFpbHMsIFRoZW4gSSByZWNlaXZlIDUwMCB3aXRoIGVycm9yIG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHaXZlbjogSSBhbSBhdXRoZW50aWNhdGVkIGJ1dCBkYXRhYmFzZSBlbmNvdW50ZXJzIGFuIGVycm9yICh1c2luZyBjZW50cmFsaXplZCBmaXh0dXJlcylcbiAgICAgIG1vY2tHZXRTZXJ2ZXJTZXNzaW9uLm1vY2tSZXNvbHZlZFZhbHVlKHsgdXNlcjogdGVzdFVzZXJzLmpvaG4gfSBhcyBhbnkpXG4gICAgICBtb2NrUHJpc21hLnByb2plY3QuY291bnQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpKVxuXG4gICAgICAvLyBXaGVuOiBJIG1ha2UgYSBHRVQgcmVxdWVzdCB0byBcIi9hcGkvcHJvamVjdHNcIlxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQoKVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuXG4gICAgICAvLyBUaGVuOiBJIHNob3VsZCByZWNlaXZlIGEgNTAwIHN0YXR1cyBjb2RlIHdpdGggYXBwcm9wcmlhdGUgZXJyb3IgbWVzc2FnZVxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg1MDApXG4gICAgICBleHBlY3QoZGF0YSkudG9FcXVhbCh7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHByb2plY3RzJyB9KVxuICAgIH0pXG4gIH0pXG59KSAiXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJhdXRoT3B0aW9ucyIsImdldFNlcnZlclNlc3Npb24iLCJmbiIsInByaXNtYSIsInByb2plY3QiLCJjb3VudCIsImZpbmRNYW55IiwiZmluZFVuaXF1ZSIsImZpbmRGaXJzdCIsImNyZWF0ZSIsInVwZGF0ZSIsImRlbGV0ZSIsImRlbGV0ZU1hbnkiLCJ1c2VyIiwibW9ja0dldFNlcnZlclNlc3Npb24iLCJtb2NrUHJpc21hIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInRlc3QiLCJhdXRoZW50aWNhdGVkVXNlciIsInRlc3RVc2VycyIsImpvaG4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInVzZXJQcm9qZWN0cyIsInByb2plY3RTY2VuYXJpb3MiLCJ1c2VyV2l0aFByb2plY3RzIiwicHJvamVjdHMiLCJsZW5ndGgiLCJyZXNwb25zZSIsIkdFVCIsImRhdGEiLCJqc29uIiwiZXhwZWN0Iiwic3RhdHVzIiwidG9CZSIsInRvSGF2ZUxlbmd0aCIsImZvckVhY2giLCJ0b0hhdmVQcm9wZXJ0eSIsImFueSIsIlN0cmluZyIsIk9iamVjdCIsIk51bWJlciIsImlkIiwidG9NYXRjaE9iamVjdCIsIm5hbWUiLCJjb250cmFjdG9yIiwiYXJjaGl0ZWN0IiwidXNlcklkIiwidGVzdFByb2plY3RzIiwia2l0Y2hlblJlbm8iLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsIndoZXJlIiwiaW5jbHVkZSIsIm9iamVjdENvbnRhaW5pbmciLCJlbWFpbFNldHRpbmdzIiwiX2NvdW50Iiwic2VsZWN0IiwiZmxhZ2dlZEl0ZW1zIiwidGltZWxpbmVFbnRyaWVzIiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInRvRXF1YWwiLCJlcnJvciIsImphbmUiLCJBcnJheSIsImlzQXJyYXkiLCJtb2NrUmVqZWN0ZWRWYWx1ZSIsIkVycm9yIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7QUFXRCxvQkFBb0I7QUFDcEJBLEtBQUtDLElBQUksQ0FBQyw2Q0FBNkMsSUFBTyxDQUFBO1FBQzVEQyxhQUFhLENBQUM7SUFDaEIsQ0FBQTtBQUVBRixLQUFLQyxJQUFJLENBQUMsYUFBYSxJQUFPLENBQUE7UUFDNUJFLGtCQUFrQkgsS0FBS0ksRUFBRTtJQUMzQixDQUFBO0FBRUFKLEtBQUtDLElBQUksQ0FBQywyQkFBMkIsSUFBTyxDQUFBO1FBQzFDSSxRQUFRO1lBQ05DLFNBQVM7Z0JBQ1BDLE9BQU9QLEtBQUtJLEVBQUU7Z0JBQ2RJLFVBQVVSLEtBQUtJLEVBQUU7Z0JBQ2pCSyxZQUFZVCxLQUFLSSxFQUFFO2dCQUNuQk0sV0FBV1YsS0FBS0ksRUFBRTtnQkFDbEJPLFFBQVFYLEtBQUtJLEVBQUU7Z0JB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