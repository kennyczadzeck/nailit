(()=>{var a={};a.id=64,a.ids=[64],a.modules={3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},12269:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0})},12412:a=>{"use strict";a.exports=require("assert")},13700:(a,b,c)=>{"use strict";c.d(b,{z:()=>e});var d=c(96330);let e=globalThis.prisma??(()=>{let a="postgresql://neondb_owner:npg_avELx8uqOAc0@ep-still-paper-a5tgtem8-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require".trim();if(!a)throw console.error("DATABASE_URL environment variable is not set"),console.error("Available env vars:",Object.keys(process.env).filter(a=>a.includes("DATABASE")||a.includes("NEON"))),Error("DATABASE_URL environment variable is required");return console.log("Creating Prisma client with DATABASE_URL:",a.substring(0,30)+"..."),new d.PrismaClient({datasources:{db:{url:a}},log:["error","warn"]})})()},19854:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={};Object.defineProperty(b,"default",{enumerable:!0,get:function(){return f.default}});var e=c(12269);Object.keys(e).forEach(function(a){!("default"===a||"__esModule"===a||Object.prototype.hasOwnProperty.call(d,a))&&(a in b&&b[a]===e[a]||Object.defineProperty(b,a,{enumerable:!0,get:function(){return e[a]}}))});var f=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=g(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&({}).hasOwnProperty.call(a,f)){var h=e?Object.getOwnPropertyDescriptor(a,f):null;h&&(h.get||h.set)?Object.defineProperty(d,f,h):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(c(35426));function g(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(g=function(a){return a?c:b})(a)}Object.keys(f).forEach(function(a){!("default"===a||"__esModule"===a||Object.prototype.hasOwnProperty.call(d,a))&&(a in b&&b[a]===f[a]||Object.defineProperty(b,a,{enumerable:!0,get:function(){return f[a]}}))})},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},60006:(a,b,c)=>{"use strict";c.r(b),c.d(b,{patchFetch:()=>s,routeModule:()=>o,serverHooks:()=>r,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>q});var d={};c.r(d),c.d(d,{GET:()=>m,POST:()=>n});var e=c(96559),f=c(48088),g=c(37719),h=c(32190),i=c(19854),j=c(70075),k=c(13700),l=c(96330);async function m(){try{let a=await (0,i.getServerSession)(j.authOptions);if(!a?.user?.id)return h.NextResponse.json({error:"Unauthorized"},{status:401});let b=await k.z.project.count({where:{userId:a.user.id}});if(0===b)return h.NextResponse.json([]);let c=await k.z.project.findMany({where:{userId:a.user.id},include:{user:!0,emailSettings:!0,_count:{select:{flaggedItems:{where:{status:"PENDING"}},timelineEntries:!0}}},orderBy:[{status:"asc"},{createdAt:"desc"}]});return h.NextResponse.json(c)}catch(a){return console.error("Error fetching projects:",a),h.NextResponse.json({error:"Failed to fetch projects"},{status:500})}}async function n(a){try{let b,c,d,e,f=await (0,i.getServerSession)(j.authOptions);if(!f?.user?.id)return h.NextResponse.json({error:"Unauthorized"},{status:401});try{b=await a.json()}catch{return h.NextResponse.json({error:"Invalid JSON body"},{status:400})}let{name:g,description:m,teamMembers:n,address:o,budget:p,startDate:q,endDate:r}=b;if(!g||!q||!o||!r||!p||!m)return h.NextResponse.json({error:"Missing required fields: name, startDate, address, endDate, budget, description"},{status:400});if(!n||!Array.isArray(n)||0===n.length)return h.NextResponse.json({error:"At least one team member is required"},{status:400});if(!n.some(a=>"GENERAL_CONTRACTOR"===a.role))return h.NextResponse.json({error:"A General Contractor is required"},{status:400});for(let a of n)if(!a.name||!a.email||!a.role)return h.NextResponse.json({error:"All team members must have name, email, and role"},{status:400});try{if(c="string"==typeof p?parseFloat(p.replace(/[,$]/g,"")):Number(p),isNaN(c))throw Error("Invalid budget value")}catch{return h.NextResponse.json({error:"Invalid budget format"},{status:400})}try{if(d=new Date(q),e=new Date(r),isNaN(d.getTime())||isNaN(e.getTime()))throw Error("Invalid date values")}catch{return h.NextResponse.json({error:"Invalid date format"},{status:400})}let s=["GENERAL_CONTRACTOR","ARCHITECT_DESIGNER","PROJECT_MANAGER"];for(let a of n)if(!s.includes(a.role))return h.NextResponse.json({error:`Invalid role: ${a.role}`},{status:400});let t=await k.z.$transaction(async a=>{await a.user.upsert({where:{id:f.user.id},update:{},create:{id:f.user.id,name:f.user.name??"",email:f.user.email??"",image:f.user.image??""}});let b=await a.project.create({data:{name:String(g),description:String(m),address:String(o),budget:c,startDate:d,endDate:e,userId:f.user.id}});return await a.teamMember.createMany({data:n.map(a=>({name:String(a.name),email:String(a.email),role:a.role,projectId:b.id}))}),await a.emailSettings.create({data:{projectId:b.id,monitoringEnabled:!0,notificationsEnabled:!0,weeklyReports:!0,highPriorityAlerts:!0}}),await a.timelineEntry.create({data:{title:"Project Created",description:`The project "${b.name}" was successfully created.`,category:l.TimelineCategory.UPDATE,date:new Date,impact:"Project kickoff",projectId:b.id,verified:!0}}),a.project.findUnique({where:{id:b.id},include:{teamMembers:!0,emailSettings:!0}})});return h.NextResponse.json(t,{status:201})}catch(b){let a=b instanceof Error?b.message:"Unknown error";if(console.error("Project creation failed:",a,b),b instanceof l.Prisma.PrismaClientKnownRequestError&&"P2002"===b.code)return h.NextResponse.json({error:"A project with this name already exists."},{status:409});return h.NextResponse.json({error:"Failed to create project",details:a},{status:500})}}let o=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/kennyc/code/personal/nailit/app/api/projects/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:p,workUnitAsyncStorage:q,serverHooks:r}=o;function s(){return(0,g.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:q})}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70075:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GET:()=>i,POST:()=>i,authOptions:()=>h});var d=c(35426),e=c(36344),f=c(16467),g=c(13700);let h={adapter:(0,f.y)(g.z),providers:[(0,e.A)({clientId:"442433418686-sahpnrfagrs9lfs1pdee2m06e4g2ukdc.apps.googleusercontent.com",clientSecret:"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"})],callbacks:{session:async({session:a,token:b})=>(b&&a?.user&&(a.user.id=b.sub),a),async jwt({token:a,user:b,account:c}){if(b)a.sub=b.id;else if(c&&!a.sub)try{let b=await g.z.user.findFirst({where:{accounts:{some:{provider:c.provider,providerAccountId:c.providerAccountId}}}});b&&(a.sub=b.id)}catch(a){console.error("Error finding user in JWT callback:",a)}return a}},pages:{signIn:"/auth/signin",error:"/auth/error"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},debug:!1},i=(0,d.default)(h)},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},94735:a=>{"use strict";a.exports=require("events")},96330:a=>{"use strict";a.exports=require("@prisma/client")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=a=>b(b.s=a),d=b.X(0,[7719,580,4999,4973],()=>c(60006));module.exports=d})();