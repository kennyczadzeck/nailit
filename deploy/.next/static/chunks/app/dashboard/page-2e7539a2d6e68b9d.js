(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{966:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(5155),r=s(2115),c=s(2108),i=s(5695),l=s(2885),n=s(2994),o=s(4768),d=s(6479),x=s(7813),m=s(2771),h=s(4307),j=s(8593),g=s(6865),u=s(5494),p=s(7765),f=s(5628);function y(){var e;let{data:t,status:s}=(0,c.useSession)(),y=(0,i.useRouter)(),[v,w]=(0,r.useState)([]),[N,A]=(0,r.useState)([]),[b,k]=(0,r.useState)(!0),[C,E]=(0,r.useState)(!1),[D,P]=(0,r.useState)(!1),[S,T]=(0,r.useState)(!1),[L,R]=(0,r.useState)(""),[_,Z]=(0,r.useState)("info"),I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";R(e),Z(t),T(!0)},O=e=>{let t=new Date().getTime()-e.getTime(),s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);return s<60?"".concat(s," minutes ago"):a<24?"".concat(a," hours ago"):"".concat(r," days ago")},W=(0,r.useCallback)(async e=>{try{let[t,s]=await Promise.all([fetch("/api/timeline?projectId=".concat(e)),fetch("/api/flagged-items?projectId=".concat(e))]),a=[];t.ok&&(await t.json()).slice(0,3).forEach(t=>{var s;a.push({id:"timeline-".concat(t.id),type:"timeline",message:t.title,time:O(new Date(t.createdAt)),project:(null==(s=v.find(t=>t.id===e))?void 0:s.name)||"Project",createdAt:new Date(t.createdAt)})}),s.ok&&(await s.json()).slice(0,2).forEach(t=>{var s;a.push({id:"flagged-".concat(t.id),type:"flagged",message:"Flagged: ".concat(t.title),time:O(new Date(t.createdAt)),project:(null==(s=v.find(t=>t.id===e))?void 0:s.name)||"Project",createdAt:new Date(t.createdAt)})}),a.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),A(a.slice(0,5))}catch(e){console.error("Error fetching recent activity:",e),A([])}},[v]),B=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/projects");if(e.ok){let t=await e.json();w(t),t.length>0&&await W(t[0].id)}}catch(e){console.error("Error fetching projects:",e)}finally{k(!1)}},[W]),F=v.find(e=>"ACTIVE"===e.status),M=async()=>{if(F)try{E(!0);let e=await fetch("/api/projects/".concat(F.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"archive"})});if(e.ok)await B(),I("Project archived successfully! Ready to create a new project.","success");else{let t=await e.json();I(t.error||"Failed to archive project","error")}}catch(e){console.error("Error archiving project:",e),I("Failed to archive project","error")}finally{E(!1),P(!1)}};if((0,r.useEffect)(()=>{let e=e=>{if(e.metaKey||e.ctrlKey)switch(e.key.toLowerCase()){case"a":e.preventDefault(),F&&!C&&P(!0);break;case"n":e.preventDefault(),F||(window.location.href="/projects/create")}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[F,C]),(0,r.useEffect)(()=>{if("loading"!==s){if(!t)return void y.push("/auth/signin");B()}},[t,s,y,B]),(0,r.useEffect)(()=>{b||0!==v.length||y.push("/projects/create")},[b,v.length,y]),!t)return null;if(b)return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[(0,a.jsx)(l.V,{}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-[#34A853] rounded-full animate-spin mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Loading your dashboard..."})]})})})]});let V=v.filter(e=>"ARCHIVED"===e.status),H=!!F,$=e=>{switch(e){case"timeline":return(0,a.jsx)(m.A,{className:"w-5 h-5 text-gray-500"});case"flagged":return(0,a.jsx)(h.A,{className:"w-5 h-5 text-gray-500"});case"email":return(0,a.jsx)(j.A,{className:"w-5 h-5 text-gray-500"});default:return(0,a.jsx)(g.A,{className:"w-5 h-5 text-gray-500"})}};return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[(0,a.jsx)(l.V,{}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["Welcome back, ",(null==t||null==(e=t.user)?void 0:e.name)||"User",". Here's what's happening."]})]}),H&&(0,a.jsxs)(o.$,{onClick:()=>P(!0),variant:"outline",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Archive Current Project"]}),!H&&v.length>0&&(0,a.jsxs)(o.$,{onClick:()=>window.location.href="/projects/create",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Create New Project"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[H?(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{children:"Active Project"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:F.contractor})]})}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:F.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Started on ",new Date(F.startDate).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex gap-8 mt-4 pt-4 border-t",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:F._count.timelineEntries}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Timeline Events"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:F._count.flaggedItems}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Flagged Items"})]})]})]})]}):(0,a.jsxs)(n.Zp,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,a.jsx)(f.A,{className:"w-12 h-12 text-amber-400"}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"No Active Project"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"All your projects are archived. Create a new one to get started."}),(0,a.jsxs)(o.$,{className:"mt-6",onClick:()=>window.location.href="/projects/create",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Create New Project"]})]}),V.length>0&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Archived Projects"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:V.map(e=>(0,a.jsxs)("li",{className:"py-3 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.contractor})]}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["Archived on ",new Date(e.createdAt).toLocaleDateString()]})]},e.id))})})]})]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Recent Activity"})}),(0,a.jsx)(n.Wu,{children:N.length>0?(0,a.jsx)("ul",{className:"space-y-4",children:N.map(e=>(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-1",children:$(e.type)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-700",children:e.message}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[e.time," on ",e.project]})]})]},e.id))}):(0,a.jsx)("div",{className:"text-center py-6",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No recent activity to display."})})})]})})]})]})}),D&&H&&(0,a.jsx)(d.u,{isOpen:D,onClose:()=>P(!1),onConfirm:M,title:"Archive Project",description:'Are you sure you want to archive "'.concat(F.name,'"? You can view archived projects but cannot make changes.'),confirmText:C?"Archiving...":"Yes, Archive",cancelText:"Cancel",type:"warning",loading:C}),(0,a.jsx)(x.y,{isOpen:S,onClose:()=>T(!1),title:L,type:_})]})}},1787:(e,t,s)=>{Promise.resolve().then(s.bind(s,966))},7765:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(2115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...c}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},c),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,2108,6874,4284,1745,8441,1684,7358],()=>t(1787)),_N_E=e.O()}]);