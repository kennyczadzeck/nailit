# Security Notes for NailIt Database

## Current Status: ⚠️ Database Publicly Accessible

**Why**: AWS Amplify cannot access databases in private VPC subnets
**Risk Level**: Medium (development), High (production)

## Current Mitigations Applied:
- ✅ Strong password generated by AWS Secrets Manager
- ✅ Encryption at rest enabled
- ✅ Encryption in transit enforced
- ✅ Security group rules restrict access to port 5432 only

## Additional Security Steps Needed:

### 1. Restrict Source IP Access
Update RDS security group to allow only:
```
# AWS Amplify IP ranges (if available)
# Your office/home IP for development
# Remove 0.0.0.0/0 rule if present
```

### 2. Enable Enhanced Monitoring
- Database performance insights
- CloudWatch detailed monitoring
- VPC Flow Logs

### 3. Database Activity Monitoring
```bash
# Enable PostgreSQL logging
log_statement = 'all'
log_connections = on
log_disconnections = on
```

## Production Migration Plan:

### Phase 1: Immediate (Current)
- [x] Database publicly accessible for Amplify
- [ ] Restrict security group to known IP ranges
- [ ] Enable detailed monitoring

### Phase 2: Medium-term (1-2 months)
- [ ] Implement RDS Proxy in public subnet
- [ ] Move database back to private subnet
- [ ] Use proxy for all database connections

### Phase 3: Long-term (3-6 months)
- [ ] Evaluate Aurora Serverless v2 with Data API
- [ ] Consider migration to managed service (Neon/PlanetScale)
- [ ] Implement IAM database authentication

## Alternative Architectures:

### Option A: RDS Proxy Architecture
```
Internet -> Amplify -> RDS Proxy (Public) -> RDS (Private)
```

### Option B: Aurora Serverless v2
```
Internet -> Amplify -> Data API -> Aurora Serverless
```

### Option C: App Runner
```
Internet -> App Runner (VPC) -> RDS (Private)
```

## Monitoring & Alerts:
- [ ] CloudWatch alarms for unusual connection patterns
- [ ] AWS GuardDuty for threat detection
- [ ] Database audit logging
- [ ] Failed login attempt monitoring 