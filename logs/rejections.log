{"level":"error","message":"unhandledRejection: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\nPrismaClientKnownRequestError: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\n    at Zn.handleRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:7459)\n    at Zn.handleAndLogRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6784)\n    at Zn.request (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6491)\n    at async l (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:130:9778)\n    at async OAuthSessionManager.createOAuthSession (/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:7)\n    at async connectGmailToProject (/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts:50:23)","metadata":{"error":{"code":"P2003","meta":{"modelName":"EmailSettings","constraint":"email_settings_projectId_fkey"},"clientVersion":"6.8.2","name":"PrismaClientKnownRequestError"},"stack":"PrismaClientKnownRequestError: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\n    at Zn.handleRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:7459)\n    at Zn.handleAndLogRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6784)\n    at Zn.request (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6491)\n    at async l (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:130:9778)\n    at async OAuthSessionManager.createOAuthSession (/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:7)\n    at async connectGmailToProject (/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts:50:23)","rejection":true,"date":"Thu Jul 03 2025 13:34:31 GMT-0400 (Eastern Daylight Time)","process":{"pid":48670,"uid":501,"gid":20,"cwd":"/Users/kennyc/code/personal/nailit","execPath":"/Users/kennyc/.nvm/versions/node/v22.16.0/bin/node","version":"v22.16.0","argv":["/Users/kennyc/.nvm/versions/node/v22.16.0/bin/node","/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts"],"memoryUsage":{"rss":122671104,"heapTotal":33243136,"heapUsed":15808816,"external":3813530,"arrayBuffers":76453}},"os":{"loadavg":[6.0380859375,4.5478515625,3.828125],"uptime":2488037},"trace":[{"column":7459,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.handleRequestError","line":121,"method":"handleRequestError","native":false},{"column":6784,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.handleAndLogRequestError","line":121,"method":"handleAndLogRequestError","native":false},{"column":6491,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.request","line":121,"method":"request","native":false},{"column":9778,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"async l","line":130,"method":null,"native":false},{"column":7,"file":"/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts","function":"async OAuthSessionManager.createOAuthSession","line":59,"method":"createOAuthSession","native":false},{"column":23,"file":"/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts","function":"async connectGmailToProject","line":50,"method":null,"native":false}]},"timestamp":"2025-07-03T17:34:31.806Z","environment":"development","service":"nailit","version":"0.1.0"}
{"level":"error","message":"unhandledRejection: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\nPrismaClientKnownRequestError: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\n    at Zn.handleRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:7459)\n    at Zn.handleAndLogRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6784)\n    at Zn.request (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6491)\n    at async l (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:130:9778)\n    at async OAuthSessionManager.createOAuthSession (/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:7)\n    at async connectGmailToProject (/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts:50:23)","metadata":{"error":{"code":"P2003","meta":{"modelName":"EmailSettings","constraint":"email_settings_projectId_fkey"},"clientVersion":"6.8.2","name":"PrismaClientKnownRequestError"},"stack":"PrismaClientKnownRequestError: \nInvalid `prisma.emailSettings.upsert()` invocation in\n/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:34\n\n  56 await this.revokeExistingSession(projectId, userId, 'reauthorization');\n  57 \n  58 // Create new OAuth session\n→ 59 await prisma.emailSettings.upsert(\nForeign key constraint violated on the constraint: `email_settings_projectId_fkey`\n    at Zn.handleRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:7459)\n    at Zn.handleAndLogRequestError (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6784)\n    at Zn.request (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:121:6491)\n    at async l (/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js:130:9778)\n    at async OAuthSessionManager.createOAuthSession (/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts:59:7)\n    at async connectGmailToProject (/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts:50:23)","rejection":true,"date":"Thu Jul 03 2025 13:35:42 GMT-0400 (Eastern Daylight Time)","process":{"pid":48731,"uid":501,"gid":20,"cwd":"/Users/kennyc/code/personal/nailit","execPath":"/Users/kennyc/.nvm/versions/node/v22.16.0/bin/node","version":"v22.16.0","argv":["/Users/kennyc/.nvm/versions/node/v22.16.0/bin/node","/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts"],"memoryUsage":{"rss":123334656,"heapTotal":32980992,"heapUsed":16016216,"external":3780517,"arrayBuffers":43424}},"os":{"loadavg":[5.20751953125,4.47705078125,3.8291015625],"uptime":2488072},"trace":[{"column":7459,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.handleRequestError","line":121,"method":"handleRequestError","native":false},{"column":6784,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.handleAndLogRequestError","line":121,"method":"handleAndLogRequestError","native":false},{"column":6491,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"Zn.request","line":121,"method":"request","native":false},{"column":9778,"file":"/Users/kennyc/code/personal/nailit/node_modules/@prisma/client/runtime/library.js","function":"async l","line":130,"method":null,"native":false},{"column":7,"file":"/Users/kennyc/code/personal/nailit/app/lib/oauth-session-manager.ts","function":"async OAuthSessionManager.createOAuthSession","line":59,"method":"createOAuthSession","native":false},{"column":23,"file":"/Users/kennyc/code/personal/nailit/scripts/email-testing/connect-gmail-to-project.ts","function":"async connectGmailToProject","line":50,"method":null,"native":false}]},"timestamp":"2025-07-03T17:35:42.745Z","environment":"development","service":"nailit","version":"0.1.0"}
